diff -ur satyr-0.15.orig/configure.ac satyr-0.15/configure.ac
--- satyr-0.15.orig/configure.ac	2014-09-10 15:22:28.000000000 +0100
+++ satyr-0.15/configure.ac	2014-10-23 09:48:20.934494824 +0100
@@ -113,6 +113,7 @@
 AC_CHECK_LIB([unwind-coredump], [main])
 
 # rpm
+PKG_CHECK_MODULES([RPM], [rpm])
 AC_CHECK_LIB([rpm], [main])
 
 # c++ symbol demangling
Only in satyr-0.15: configure.ac.orig
diff -ur satyr-0.15.orig/lib/Makefile.am satyr-0.15/lib/Makefile.am
--- satyr-0.15.orig/lib/Makefile.am	2014-06-20 17:32:38.000000000 +0100
+++ satyr-0.15/lib/Makefile.am	2014-10-23 10:00:04.891442962 +0100
@@ -62,8 +62,8 @@
 	unstrip.c \
 	utils.c
 
-libsatyr_conv_la_CFLAGS = -Wall -Wformat=2 -std=gnu99 -D_GNU_SOURCE -I$(top_srcdir)/include $(GLIB_CFLAGS)
-libsatyr_conv_la_LDFLAGS = $(GLIB_LIBS)
+libsatyr_conv_la_CFLAGS = -Wall -Wformat=2 -std=gnu99 -D_GNU_SOURCE -I$(top_srcdir)/include $(GLIB_CFLAGS) $(RPM_CFLAGS)
+libsatyr_conv_la_LDFLAGS = $(GLIB_LIBS) $(RPM_LIBS)
 
 if HAVE_LIBOPCODES
 # Conditional link is required to avoid linking to a library without
Only in satyr-0.15/lib: Makefile.am~
Only in satyr-0.15/lib: .Makefile.am.un~
diff -ur satyr-0.15.orig/lib/rpm.c satyr-0.15/lib/rpm.c
--- satyr-0.15.orig/lib/rpm.c	2014-02-13 15:40:41.000000000 +0000
+++ satyr-0.15/lib/rpm.c	2014-10-23 09:48:20.935494824 +0100
@@ -25,11 +25,11 @@
 #include "internal_utils.h"
 #include <errno.h>
 #ifdef HAVE_LIBRPM
-#include <rpm/rpmlib.h>
+#include <rpm/rpmtag.h>
 #include <rpm/rpmdb.h>
+#include <rpm/rpmio.h>
+#include <rpm/rpmrc.h>
 #include <rpm/rpmts.h>
-#include <rpm/rpmtd.h>
-#include <rpm/header.h>
 #endif
 #include <fcntl.h>
 #include <assert.h>
@@ -277,18 +277,18 @@
                   rpmTag tag,
                   char **result)
 {
-    rpmtd tag_data = rpmtdNew();
-    int success = headerGet(header,
-                            tag,
-                            tag_data,
-                            HEADERGET_DEFAULT);
+    HE_s h;
+    memset(&h, 0, sizeof(h));
+    h.tag = tag;
+    h.ix = -1;
+    int success = headerGet(header, &h, 0);
 
     if (success != 1)
         return false;
 
-    const char *str = rpmtdGetString(tag_data);
+    const char *str = (h.t == RPM_STRING_TYPE) ? h.p.str :
+	    (((h.t == RPM_STRING_ARRAY_TYPE) || (h.t == RPM_I18NSTRING_TYPE)) ? h.p.argv[0] : NULL);
     *result = (str ? sr_strdup(str) : NULL);
-    rpmtdFree(tag_data);
     return str;
 }
 
@@ -297,20 +297,21 @@
                   rpmTag tag,
                   uint32_t *result)
 {
-    rpmtd tag_data = rpmtdNew();
-    int success = headerGet(header,
-                            tag,
-                            tag_data,
-                            HEADERGET_DEFAULT);
+    HE_s h;
+    memset(&h, 0, sizeof(h));
+    h.tag = tag;
+    h.ix = -1;
+    int success = headerGet(header, &h, 0);
 
     if (success != 1)
         return false;
 
-    uint32_t *num = rpmtdGetUint32(tag_data);
+    if (h.t != RPM_UINT32_TYPE)
+        return false;
+    uint32_t *num = h.p.ui32p;
     if (num)
         *result = *num;
 
-    rpmtdFree(tag_data);
     return num;
 }
 
@@ -389,14 +390,14 @@
     }
 
     rpmts ts = rpmtsCreate();
-    rpmdbMatchIterator iter = rpmtsInitIterator(ts,
+    rpmmi iter = rpmtsInitIterator(ts,
                                                 RPMTAG_NAME,
                                                 name,
                                                 strlen(name));
 
     struct sr_rpm_package *result = NULL;
     Header header;
-    while ((header = rpmdbNextIterator(iter)))
+    while ((header = rpmmiNext(iter)))
     {
         struct sr_rpm_package *package = header_to_rpm_info(header,
                                                             error_message);
@@ -410,7 +411,7 @@
         result = sr_rpm_package_append(result, package);
     }
 
-    rpmdbFreeIterator(iter);
+    rpmmiFree(iter);
     rpmtsFree(ts);
     return result;
 #else
@@ -431,14 +432,14 @@
     }
 
     rpmts ts = rpmtsCreate();
-    rpmdbMatchIterator iter = rpmtsInitIterator(ts,
+    rpmmi iter = rpmtsInitIterator(ts,
                                                 RPMTAG_BASENAMES,
                                                 path,
                                                 strlen(path));
 
     struct sr_rpm_package *result = NULL;
     Header header;
-    while ((header = rpmdbNextIterator(iter)))
+    while ((header = rpmmiNext(iter)))
     {
         struct sr_rpm_package *package = header_to_rpm_info(header,
                                                             error_message);
@@ -452,7 +453,7 @@
         result = sr_rpm_package_append(result, package);
     }
 
-    rpmdbFreeIterator(iter);
+    rpmmiFree(iter);
     rpmtsFree(ts);
     return result;
 #else
Only in satyr-0.15/lib: rpm.c.orig
